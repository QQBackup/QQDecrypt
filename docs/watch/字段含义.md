感谢项目 [GroupChatAnnualReport](https://github.com/mobyw/GroupChatAnnualReport) 提供。

## 数据库字段含义

群聊数据 `group_msg_table` 表中的部分列含义如下：

| 列名    | 类型    | 含义       | 说明                                                               |
| ----- | ----- | -------- | ---------------------------------------------------------------- |
| 40001 | int   | 消息 ID    |                                                                  |
| 40003 | int   | 消息序号     | 在每个群聊中依次递增                                                       |
| 40021 | str   | 群号       |                                                                  |
| 40027 | int   | 群号       |                                                                  |
| 40030 | int   | 群号       | QQNT 保存的群号                                                       |
| 40033 | int   | 发送者 QQ 号 | QQNT 保存发送者 QQ 号                                                  |
| 40050 | int   | 时间       | 时间戳                                                              |
| 40058 | int   | 日期       | 当日 0 时整的时间戳格式，时区为 GMT+0800                                       |
| 40090 | str   | 发送者群名片   | 旧版 QQ 迁移数据中格式为 `name(12345)` 或 `name<i@example.com>`， QQNT 中为群名片 |
| 40093 | str   | 发送者昵称    | 旧版 QQ 此字段为空，QQNT 中未设置群名片时才有此字段                                   |
| 40600 | bytes | 撤回状态     | protobuf 格式                                                      |
| 40800 | bytes | 消息内容     | protobuf 格式                                                      |
| 40850 | int   | 回复消息序号   | 该消息所回复的消息的序号                                                     |

私聊数据 `c2c_msg_table` 表中的部分列含义如下：

| 列名    | 类型    | 含义        | 说明                      |
| ----- | ----- | --------- | ----------------------- |
| 40030 | int   | 私聊对象 QQ 号 | 对方 QQ 号（无论是对方还是自己发送的消息） |
| 40033 | int   | 发送者 QQ 号  | 发送者的 QQ 号               |
| 40050 | int   | 时间        | 时间戳（单位为秒）               |
| 40058 | int   | 日期        | 当日 0 时整的时间戳格式           |
| 40093 | str   | 消息发送者     | QQ 昵称或是备注名              |
| 40800 | bytes | 消息内容      | protobuf 格式             |

## Protobuf 消息格式

消息内容 protobuf 的部分字段含义如下：

| Field Number | 类型                        | 含义  | 说明                                  |
| ------------ | ------------------------- | --- | ----------------------------------- |
| 48000        | protobuf 或 protobuf array | 消息段 | 一条消息中可以有多个消息段，按内容顺序，类似于富文本；部分类型中可嵌套 |

消息段（48000）的部分字段含义如下：

| Field Number | 类型       | 含义                              | 说明         |
| ------------ | -------- | ------------------------------- | ---------- |
| 45001        | int      | 消息段 ID                          |            |
| 45002        | int      | 消息类型                            | 类型较多，见另表   |
| 45101        | str      | 消息文本                            | 适用于文本消息    |
| 45102        | str      | 图片文件名                           | 适用于图片消息    |
| 45402        | str      | 图片文件名                           | 适用于图片消息    |
| 45411        | int      | 图片宽度（压制后）                       | 适用于图片消息    |
| 45412        | int      | 图片高度（压制后）                       | 适用于图片消息    |
| 45812        | str      | 本地缓存目录                          | 适用于图片消息    |
| 45815        | str      | 替代文本，如 "[动画表情]"                 | 适用于图片消息    |
| 47402        | int      | 原消息序号                           | 适用于引用消息    |
| 47403        | int      | 原消息发送者                          | 适用于引用消息    |
| 47404        | int      | 原消息时间                           | 适用于引用消息    |
| 47410        | protobuf | 格式复杂，存储原消息文本，疑似原消息过期后用以替代 47423 | 适用于引用消息    |
| 47413        | str      | 显示的引用文本                         | 适用于引用消息    |
| 47423        | protobuf | 引用消息段（嵌套）                       | 适用于引用消息    |
| 47713        | str      | 撤回消息后缀                          | 适用于系统撤回消息  |
| 48602        | str      | XML 消息内容                        | 适用于 XML 消息 |

其中消息类型（45002）的已知消息类型与对应序号如下：

| 45002 | 含义     | 说明                                                             |
| ----- | ------ | -------------------------------------------------------------- |
| 1     | 文本消息   | 普通纯文本消息，以及 at 消息本质上为**独立成消息段**且内容为 "@群昵称" 的消息，包含于此             |
| 2     | 图片消息   |                                                                |
| 3     | 文件消息   |                                                                |
| 4     | 语音消息   |                                                                |
| 6     | 表情     | https://bot.q.qq.com/wiki/develop/api/openapi/emoji/model.html |
| 7     | 引用     | 即常说的“回复”，位于消息段开头，其后为正式消息                                       |
| 8     | 系统消息   | 显示于屏幕中央的灰色小字提示，如撤回、接收文件                                        |
| 10    | 应用消息   |                                                                |
| 11    | 表情     |                                                                |
| 16    | XML 消息 | 转发聊天记录本质上也是 XML 消息，包含于此                                        |
| 21    | 通话消息   |                                                                |
| 26    | 动态消息   |                                                                |
